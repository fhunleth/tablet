# SPDX-FileCopyrightText: 2025 Frank Hunleth
#
# SPDX-License-Identifier: Apache-2.0
#
defmodule Tablet.UnicodeBoxStyleTest do
  use ExUnit.Case, async: true

  import TestUtilities

  alias Tablet.Styles

  doctest Styles

  test "basic" do
    data = generate_table(2, 3)

    output =
      Tablet.render(data, style: :unicode_box)
      |> Tablet.simplify()

    expected = [
      """
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ key_1 â”‚ key_2 â”‚ key_3   â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚ Alpha â”‚ Bravo â”‚ Charlie â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚ Delta â”‚ Echo  â”‚ Foxtrot â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      """
    ]

    assert output == expected
  end

  test "title" do
    data = generate_table(2, 3)

    output =
      Tablet.render(data, name: "Title", style: :unicode_box)
      |> Tablet.simplify()

    expected = [
      """
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚          Title          â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚ key_1 â”‚ key_2 â”‚ key_3   â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚ Alpha â”‚ Bravo â”‚ Charlie â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚ Delta â”‚ Echo  â”‚ Foxtrot â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      """
    ]

    assert output == expected
  end

  test "one row" do
    data = generate_table(1, 3)

    output =
      Tablet.render(data, style: :unicode_box)
      |> ansidata_to_string()

    expected = """
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ key_1 â”‚ key_2 â”‚ key_3   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Alpha â”‚ Bravo â”‚ Charlie â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    """

    assert output == expected
  end

  test "one column" do
    data = generate_table(3, 1)

    output =
      Tablet.render(data, style: :unicode_box)
      |> ansidata_to_string()

    expected = """
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ key_1   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Alpha   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Bravo   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Charlie â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    """

    assert output == expected
  end

  test "no rows or columns" do
    output = Tablet.render([], style: :unicode_box) |> ansidata_to_string()

    expected = """
    â”Œâ”
    â””â”˜
    """

    assert output == expected
  end

  test "no rows" do
    output =
      Tablet.render([], keys: ["key_1"], style: :unicode_box)
      |> ansidata_to_string()

    expected = """
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”
    â”‚ key_1 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”˜
    """

    assert output == expected
  end

  test "empty with title" do
    output =
      Tablet.render([], keys: ["key_1"], name: "Long title", style: :unicode_box)
      |> ansidata_to_string()

    expected = """
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”
    â”‚Long tâ€¦â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ key_1 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”˜
    """

    assert output == expected
  end

  test "multi-column" do
    data = generate_table(5, 3)

    output =
      Tablet.render(data, style: :unicode_box, wrap_across: 2)
      |> ansidata_to_string()

    expected = """
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ key_1  â”‚ key_2    â”‚ key_3   â”‚ key_1  â”‚ key_2    â”‚ key_3   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Alpha  â”‚ Bravo    â”‚ Charlie â”‚ Juliet â”‚ Kilo     â”‚ Lima    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Delta  â”‚ Echo     â”‚ Foxtrot â”‚ Mike   â”‚ November â”‚ Oscar   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Golf   â”‚ Hotel    â”‚ India   â”‚        â”‚          â”‚         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    """

    assert output == expected
  end

  test "multi-column title" do
    data = generate_table(5, 3)

    output =
      Tablet.render(data, name: "Multi-column Title", style: :unicode_box, wrap_across: 2)
      |> ansidata_to_string()

    expected = """
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    Multi-column Title                     â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ key_1  â”‚ key_2    â”‚ key_3   â”‚ key_1  â”‚ key_2    â”‚ key_3   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Alpha  â”‚ Bravo    â”‚ Charlie â”‚ Juliet â”‚ Kilo     â”‚ Lima    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Delta  â”‚ Echo     â”‚ Foxtrot â”‚ Mike   â”‚ November â”‚ Oscar   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Golf   â”‚ Hotel    â”‚ India   â”‚        â”‚          â”‚         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    """

    assert output == expected
  end

  test "multi-column expanding" do
    data = generate_table(7, 3)

    output =
      Tablet.render(data,
        name: "Multi-column Title",
        style: :unicode_box,
        column_widths: %{"key_3" => :expand},
        total_width: 80,
        wrap_across: 3
      )
      |> ansidata_to_string()

    expected = """
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                             Multi-column Title                              â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¤
    â”‚ key_1  â”‚ key_2    â”‚ keâ€¦ â”‚ key_1  â”‚ key_2    â”‚ keâ€¦ â”‚ key_1  â”‚ key_2    â”‚ keâ€¦ â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
    â”‚ Alpha  â”‚ Bravo    â”‚ Châ€¦ â”‚ Juliet â”‚ Kilo     â”‚ Liâ€¦ â”‚ Sierra â”‚ Tango    â”‚ Unâ€¦ â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
    â”‚ Delta  â”‚ Echo     â”‚ Foâ€¦ â”‚ Mike   â”‚ November â”‚ Osâ€¦ â”‚        â”‚          â”‚     â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
    â”‚ Golf   â”‚ Hotel    â”‚ Inâ€¦ â”‚ Papa   â”‚ Quebec   â”‚ Roâ€¦ â”‚        â”‚          â”‚     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
    """

    assert output == expected
  end

  test "Japanese content" do
    data = [
      %{åå‰: "å±±ç”°å¤ªéƒ", è·æ¥­: "ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢", ã‚³ãƒ¡ãƒ³ãƒˆ: "ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚"},
      %{åå‰: "ä½è—¤èŠ±å­", è·æ¥­: "ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼", ã‚³ãƒ¡ãƒ³ãƒˆ: "UI/UXã®æ”¹å–„ãŒå¿…è¦ã§ã™ã€‚"},
      %{åå‰: "ä¸­æ‘ä¸€éƒ", è·æ¥­: "ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼", ã‚³ãƒ¡ãƒ³ãƒˆ: "ä¼šè­°ã¯åˆå¾Œ3æ™‚ã‹ã‚‰ã€‚"},
      %{åå‰: "ä¼Šè—¤ç¾å’²", è·æ¥­: "ãƒ†ã‚¹ãƒˆæ‹…å½“", ã‚³ãƒ¡ãƒ³ãƒˆ: "ãƒã‚°ãŒ3ä»¶è¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚"},
      %{åå‰: "é«˜æ©‹å¥", è·æ¥­: "å–¶æ¥­", ã‚³ãƒ¡ãƒ³ãƒˆ: "æ–°è¦é¡§å®¢ã¨ã®å¥‘ç´„ãŒæˆç«‹ã—ã¾ã—ãŸï¼"},
      %{åå‰: "å°æ—ç›´å­", è·æ¥­: "ã‚µãƒãƒ¼ãƒˆ", ã‚³ãƒ¡ãƒ³ãƒˆ: "ãŠå•ã„åˆã‚ã›ã¯24æ™‚é–“ä»¥å†…ã«è¿”ä¿¡ã€‚"},
      %{åå‰: "åŠ è—¤èª ", è·æ¥­: "é–‹ç™º", ã‚³ãƒ¡ãƒ³ãƒˆ: "ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŠé¡˜ã„ã—ã¾ã™ã€‚"},
      %{åå‰: "ç”°ä¸­å®Ÿ", è·æ¥­: "ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°", ã‚³ãƒ¡ãƒ³ãƒˆ: "ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã®æˆæœãŒå‡ºã¦ãã¾ã—ãŸã€‚"}
    ]

    output =
      Tablet.render(data, name: "ç¤¾å“¡ä¸€è¦§è¡¨", keys: [:åå‰, :è·æ¥­, :ã‚³ãƒ¡ãƒ³ãƒˆ], style: :unicode_box)
      |> ansidata_to_string()

    # Be careful: This renders correctly in the terminal, but it's rendered
    # incorrectly in some editors. I assume it's a font issue.
    expected = """
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                           ç¤¾å“¡ä¸€è¦§è¡¨                           â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ :åå‰    â”‚ :è·æ¥­          â”‚ :ã‚³ãƒ¡ãƒ³ãƒˆ                          â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ å±±ç”°å¤ªéƒ â”‚ ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢     â”‚ ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚             â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ ä½è—¤èŠ±å­ â”‚ ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼     â”‚ UI/UXã®æ”¹å–„ãŒå¿…è¦ã§ã™ã€‚            â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ ä¸­æ‘ä¸€éƒ â”‚ ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼   â”‚ ä¼šè­°ã¯åˆå¾Œ3æ™‚ã‹ã‚‰ã€‚                â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ ä¼Šè—¤ç¾å’² â”‚ ãƒ†ã‚¹ãƒˆæ‹…å½“     â”‚ ãƒã‚°ãŒ3ä»¶è¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚          â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ é«˜æ©‹å¥   â”‚ å–¶æ¥­           â”‚ æ–°è¦é¡§å®¢ã¨ã®å¥‘ç´„ãŒæˆç«‹ã—ã¾ã—ãŸï¼   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ å°æ—ç›´å­ â”‚ ã‚µãƒãƒ¼ãƒˆ       â”‚ ãŠå•ã„åˆã‚ã›ã¯24æ™‚é–“ä»¥å†…ã«è¿”ä¿¡ã€‚   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ åŠ è—¤èª    â”‚ é–‹ç™º           â”‚ ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŠé¡˜ã„ã—ã¾ã™ã€‚       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ ç”°ä¸­å®Ÿ   â”‚ ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚° â”‚ ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã®æˆæœãŒå‡ºã¦ãã¾ã—ãŸã€‚ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    """

    assert output == expected
  end

  test "multi-line cells" do
    data = generate_table(3, 3, :multiline)

    output =
      Tablet.render(data, name: "Multi-line cells", style: :unicode_box)
      |> ansidata_to_string()

    expected = """
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚             Multi-line cells             â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ key_1        â”‚ key_2      â”‚ key_3        â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Single line  â”‚ Two        â”‚ A            â”‚
    â”‚              â”‚ line       â”‚ three        â”‚
    â”‚              â”‚            â”‚ line value   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Fruit emojis â”‚ ã“ã‚“ã«ã¡ã¯ â”‚ Single line  â”‚
    â”‚ ğŸğŸŒğŸ’ğŸŒ´ğŸ‡   â”‚ Hello      â”‚              â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Two          â”‚ A          â”‚ Fruit emojis â”‚
    â”‚ line         â”‚ three      â”‚ ğŸğŸŒğŸ’ğŸŒ´ğŸ‡   â”‚
    â”‚              â”‚ line value â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    """

    assert output == expected
  end

  test "multi-line cells with ansidata" do
    data = [
      %{
        key1: [:green, "line one\n", "line two\n", :red, "line three", :default_color],
        key2: ["plain\nmulti\nline\ncell"]
      }
    ]

    output = Tablet.render(data, style: :unicode_box) |> Tablet.simplify()

    # Markdown formatting makes this easier due to the `<br>` tags
    expected = [
      "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ :key1      â”‚ :key2 â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ ",
      :green,
      "line one",
      :default_color,
      "   â”‚ plain â”‚\nâ”‚ ",
      :green,
      "line two",
      :default_color,
      "   â”‚ multi â”‚\nâ”‚ ",
      :green,
      :red,
      "line three",
      :default_color,
      " â”‚ line  â”‚\nâ”‚            â”‚ cell  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜\n"
    ]

    assert output == expected
  end
end
